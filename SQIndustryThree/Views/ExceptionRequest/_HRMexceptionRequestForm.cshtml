<style>
    #radioBtn a {
        margin: 1px;
    }

    .form-control, .btn {
        border-radius: 0px;
    }

    .required:after {
        content: "*";
        color: red;
    }

    .inputhidegroup {
        border: none;
        pointer-events: none;
        text-align: center;
    }

    input[type=text] {
        margin: 2px;
        padding: 2px;
    }

    #genaralInformationTable td input[type=text], #genaralInformationTable td input[type=date], #genaralInformationTable td input[type=number] {
        text-align: center;
        width: 95%;
        height: 25px;
    }

    #genaralInformationTableDeatils {
        width: 850px;
    }

    #genaralInformationTable td input[type=button] {
        height: 25px;
        width: 25px;
        border-radius: 50%;
        background-color: green;
        color: white;
    }

    #genaralInformationTable th, #genaralInformationTable td {
        margin: 0px;
        padding: 0px;
        text-align: center;
    }

    .leftlable {
        text-align: left;
    }

    #airfreight td {
        width: 12%;
        padding: 2px;
    }

    #disclaimCancel td, #otherexception td {
        padding: 2px;
    }

        #disclaimCancel td input[type=text], #airfreight td input[type=text], #otherexception td input[type=text] {
            text-align: center;
        }

    .airfreightDisplay {
        display: none;
    }
</style>


<div class="container-fluid">
    <p style="text-align:center;font-size:20px;font-weight:bold">Exception Request Approval Form</p>
    <hr style="margin:0px" />
    <div class="row">
        <div class="col-md-6">
            @*<h4 style="text-align: center; background-color: #9bb07e; padding: 5px"><strong>Courier Request Form</strong></h4>*@
            <div class="row">
                <div class="col-md-12">

                    <div class="col-md-4">
                        <label for="exception_type" class="required">Exception Type :</label>
                        <select id="exception_type" onchange="ChangeColor('#exception_type')" class="form-control">
                            <option value="0">--Select Exception Type--</option>
                            <option value="1">Additional Manpower</option>
                            @*<option value="2">Discount </option>
                                <option value="3">Claim </option>
                                <option value="4">Order Cancel</option>
                                <option value="5">Others</option>
                                <option value="6">Over Purchase </option>*@
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="exceptionReasons" class="required">Exception Reason</label>
                        <select id="exceptionReasons" onchange="ChangeColor('#exceptionReasons')" class="form-control">
                        </select>
                    </div>
                    @*<div class="col-md-2">
                            <label for="scapprover" class="required">SC Approver</label>
                            <select id="scapprover" onchange="LoadApproverList()" class="form-control">
                                <option value="0">--Supply Chain Approver--</option>
                                <option value="1">Pranab Das Gupta</option>
                                <option value="2">Prithu Bhowmik</option>
                            </select>
                        </div>*@
                    @*<div class="col-md-4">
                            <label for="locationCheck" class="required">Location:</label>
                            <select id="locationCheck" class="form-control">
                                <option>--Select Location--</option>
                            </select>
                        </div>*@
                    <div class="col-md-4">
                        <label for="business_unit" class="required">Business Unit:</label>
                        <select id="business_unit" class="form-control" onchange="LoadApproverList()">
                            <option>--Select  Business Unit--</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="month" class="required">Month</label>
                        <select name="month" class="form-control" id="month">
                            <option value="0">Select Month</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="current_date">Current Date</label>
                        <input disabled type="text" id="current_date" class="form-control">
                    </div>
                    <div class="col-md-12 remarks">
                        <label for="comments" class="comments">Comments</label>
                        <textarea type="text" id="comments" placeholder="Comments" class="form-control remarks"></textarea>
                    </div>
                    @*<div class="col-md-3">
                            <button class="btn btn-success" style="margin-bottom:-85px;margin-right:-15px;" id="showPositionCode">ADD</button>
                        </div>*@



                </div>


            </div>


            <br />
            <br />

        </div>
        <div class="col-md-6">
            @*<h4 style="text-align: center; background-color: #9bb07e; padding: 5px"><strong>Courier Request Form</strong></h4>*@
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-12">
                        <table width="100%" id="ListOfApprover" class="table table-bordered table-responsive table-condensed table-hover">

                            <thead>
                                <tr>
                                    <th></th>
                                    <th>SL</th>
                                    <th>Approver Name</th>
                                    <th>Approver Designation</th>
                                </tr>
                            </thead>
                            <tbody id="approverTable">
                            </tbody>

                        </table>
                    </div>
                    <div class="col-md-4">
                        <div class="row">
                            <div class="col-md-6">

                            </div>
                            <div class="col-md-6">

                            </div>
                        </div>
                        <br />
                        <div class="row" style="text-align:center">
                            <input type="button" style="margin-bottom:-155px;margin-right:-590px;" id="showPositionCode" class="btn btn-success" value="ADD" />
                        </div>
                        @*<div class="col-md-3">
                                <button class="btn btn-success" style="margin-bottom:-125px;margin-right:-905px;" id="showPositionCode">ADD</button>
                            </div>*@
                        <div class="row" style="text-align:center">
                            <input type="button" style="margin-bottom:-115px;margin-right:-800px;" class="btn btn-success" value="Submit For Approval" onclick="formValidate()" />
                        </div>
                    </div>

                </div>


            </div>


            <br />
            <br />

        </div>

    </div>
    <div>
        <div style="overflow-x:auto">
            <table width="100%" border="1" id="genaralInformationTable" class="table table-striped">
                <caption>Additional Manpower Summary</caption>
                <thead>
                    <tr>
                        <th class="required">Sl No</th>
                        @*<th>a</th>*@
                        <th class="required">Position Code </th>
                        <th style="display:none;"></th>
                        <th class="required">Department</th>
                        <th style="display:none;"></th>
                        <th class="required">Designation</th>
                        <th class="required">Division</th>
                        <th style="display:none;"></th>
                        <th class="required">Staff Category</th>
                        <th class="required">Current Budgeted Manpower</th>
                        <th class="required">Number of Additional Requirement</th>
                        <th class="required discount_td">To Budgeted Manpower</th>
                        <th class="required claimed_td">Details</th>
                        <th class="required material_td">Remarks</th>
                        <th class="required material_td">Action</th>
                        @*<th class="required garmentsli_td" style="display:none">Garments Liability($)</th>*@
                        <th></th>
                    </tr>
                </thead>
                <tbody id="genaralInformationBody">
                    <!--<tr>
                        <td><input type="text" id="styleName" name="styleName" placeholder="Enter Style Number" /></td>
                        <td><input type="text" id="colorName" name="colorName" placeholder="Enter Color " /></td>
                        <td><input type="text" id="PoName" name="PoName" placeholder="Enter PO Number" /></td>
                        <td><input type="date" id="odddate" name="odddate" /></td>
                        <td><input type="date" id="revisedddate" name="revisedddate" /></td>
                        <td><input type="number" step="0.01" id="quantinty" name="quantity" onchange="calculateGrandTotal()" placeholder="Enter Quantity" /></td>
                        <td><input type="number" step="0.01" id="unitprice" name="unitprice" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>
                        <td><input class="inputhidegroup" type="number" id="fobinput" name="fobinput" /></td>
                        <td class="discount_td"><input type="number" step="0.01" id="discountclaim" name="discountclaim" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>
                        <td class="claimed_td"><input type="button" step="0.01" id="claimedAmmount" name="claimedAmmount" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>
                        <td class="material_td"><input type="number" step="0.01" id="materialliability" name="materialliability" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>-->
                    @*<td style="display:none" class="garmentsli_td"><input type="number" step="0.01" id="garments_liability" name="garments_liability" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>*@
                    <!--<td>
                            <input type="button" id="addNewGenaralInformation" value="+" />
                        </td>
                    </tr>-->
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="7">Total</th>
                        <th><input class="inputhidegroup" type="text" id="totalunitprice" /></th>
                        <th><input class="inputhidegroup" type="text" id="totalFobs" /></th>
                        <th class="discount_td" style="display:none"><input class="inputhidegroup" id="totaldis" type="number" /></th>
                        <th class="claimed_td" style="display:none"><input class="inputhidegroup" id="totalclaim" type="number" /></th>
                        <th class="material_td" style="display:none"><input class="inputhidegroup" id="totalmat" type="number" /></th>
                        <th class="garmentsli_td" style="display:none"><input class="inputhidegroup" id="totalgar" type="number" /></th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
        </div>

    </div>
    <div>
        <div style="overflow-x:auto">
            <table width="100%" border="1" id="genaralInformationTableExtend" class="table table-striped">
                <caption>Additional Manpower Details</caption>
                <thead>
                    <tr>
                        @*<th class="required">Sl No</th>*@
                        @*<th>a</th>*@
                        <th class="required">Position Code </th>
                        <th style="display:none;"></th>
                        <th class="required">Section</th>
                        <th style="display:none;"></th>
                        <th class="required">Sub Section</th>
                        <th style="display:none;"></th>
                        <th class="required">Designation</th>
                        @*<th class="required">Division</th>*@
                        <th style="display:none;"></th>
                        <th class="required">Category</th>
                        <th class="required">Additional Manpower</th>
                        <th class="required material_td">Action</th>
                    </tr>
                </thead>
                <tbody id="genaralInformationBodyExtend">
                    <!--<tr>
                        <td><input type="text" id="styleName" name="styleName" placeholder="Enter Style Number" /></td>
                        <td><input type="text" id="colorName" name="colorName" placeholder="Enter Color " /></td>
                        <td><input type="text" id="PoName" name="PoName" placeholder="Enter PO Number" /></td>
                        <td><input type="date" id="odddate" name="odddate" /></td>
                        <td><input type="date" id="revisedddate" name="revisedddate" /></td>
                        <td><input type="number" step="0.01" id="quantinty" name="quantity" onchange="calculateGrandTotal()" placeholder="Enter Quantity" /></td>
                        <td><input type="number" step="0.01" id="unitprice" name="unitprice" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>
                        <td><input class="inputhidegroup" type="number" id="fobinput" name="fobinput" /></td>
                        <td class="discount_td"><input type="number" step="0.01" id="discountclaim" name="discountclaim" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>
                        <td class="claimed_td"><input type="button" step="0.01" id="claimedAmmount" name="claimedAmmount" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>
                        <td class="material_td"><input type="number" step="0.01" id="materialliability" name="materialliability" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>-->
                    @*<td style="display:none" class="garmentsli_td"><input type="number" step="0.01" id="garments_liability" name="garments_liability" onchange="calculateGrandTotal()" placeholder="Enter Price" /></td>*@
                    <!--<td>
                            <input type="button" id="addNewGenaralInformation" value="+" />
                        </td>
                    </tr>-->
                </tbody>
                @*<tfoot>
                        <tr>
                            <th colspan="8">Total</th>
                            <th><input class="inputhidegroup" type="text" id="totalFobs" /></th>
                            <th class="discount_td" style="display:none"><input class="inputhidegroup" id="totaldis" type="number" /></th>
                            <th class="claimed_td" style="display:none"><input class="inputhidegroup" id="totalclaim" type="number" /></th>
                            <th class="material_td" style="display:none"><input class="inputhidegroup" id="totalmat" type="number" /></th>
                            <th class="garmentsli_td" style="display:none"><input class="inputhidegroup" id="totalgar" type="number" /></th>
                            <th></th>
                        </tr>
                    </tfoot>*@
            </table>
        </div>

    </div>

</div>
<div class="modal" id="courierTypeModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" style="text-align: center;font-weight:bold ;">Position Code Preview</h4>
            </div>
            <div id="courierTypemodalbody" class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" id="addNewButton" class="btn btn-danger btn-sm" data-dismiss="modal">ADD</button>
                <button type="button" id="remove_button" class="btn btn-danger btn-sm" data-dismiss="modal">Close</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div id="printableareaa">
    <div class="modal" id="detailsModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                @*<div class="col-md-4">
                        <button class="btn btn-success btn-sm" id="addrowDetails">Add Row</button>
                    </div>*@

                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" style="text-align: center">Additional Manpower:  <input style="border:none;pointer-events:none;" type="text" id="head" /> </h4>
                    <h4 class="modal-title" style="text-align: center">Position Code:  <input style="border:none;pointer-events:none;" type="text" id="positionCode" /> </h4>
                </div>

                <div id="detailsModalBody" class="modal-body">


                </div>
                <div class="modal-footer">
                    <button type="button" id="addNewButtonExtend" class="btn btn-primary btn-sm">Add</button>
                    <button type="button" id="modalCloseButton" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var d = new Date();
    var monthArray = new Array();

    monthArray[6] = "July";
    monthArray[7] = "August";
    monthArray[8] = "September";
    monthArray[9] = "October";
    monthArray[10] = "November";
    monthArray[11] = "December";
    monthArray[12] = "January";
    monthArray[13] = "February";
    monthArray[14] = "March";
    monthArray[15] = "April";
    monthArray[16] = "May";
    monthArray[17] = "June";
    var currentYear = new Date().getFullYear();
    var preYear = (currentYear - 1);


    for (m = 6; m <= 17; m++) {
        var optn = document.createElement("OPTION");
        optn.text = monthArray[m];
        // server side month start from one

        if (optn.text == "January") {
            optn.value = '1'
        }
        else if (optn.text == "February") {
            optn.value = '2'
        }
        else if (optn.text == "March") {
            optn.value = '3'
        }
        else if (optn.text == "April") {
            optn.value = '4'
        }
        else if (optn.text == "May") {
            optn.value = '5'
        }
        else if (optn.text == "June") {
            optn.value = '6'
        }
        else if (optn.text == "July") {
            optn.value = '7'
        }
        else if (optn.text == "August") {
            optn.value = '8'
        }
        else if (optn.text == "September") {
            optn.value = '9'
        }
        else if (optn.text == "October") {
            optn.value = '10'
        }
        else if (optn.text == "November") {
            optn.value = '11'
        }
        else if (optn.text == "December") {
            optn.value = '12'
        }
        //optn.value = (m + 1);
        // if june selected
        if (m == 5) {
            optn.selected = true;
        }
        document.getElementById('month').options.add(optn);
    }
    $("#genaralInformationTableExtend").hide();
    LoadSection();
    LoadSubSection();
    LoadCategory();
    LoadDesignation();
    LoadBusinessUnit();
    LoadLocation();
    LoadReasonCategory();
    // LoadBuyerList();
    GetDate();

   function LoadBusinessUnit() {
       $('#business_unit').css({ "border-color": "#d3d3d3" });
       var urlpath = '@Url.Action("LoadBusinessUnit", "Admin")';
       $.ajax({
           url: urlpath,
           dataType: 'json',
           type: "Post",
           data: {},
           async: true,
           success: function (data) {
               $('#business_unit').empty();
               $('#business_unit').append("<option value='0'>--Select Business Unit--</option>");
               for (var i = 0; i < data.length; i++) {
                   $("#business_unit").append($("<option></option>").val(data[i].BusinessUnitId)
                       .html(data[i].BusinessUnitName));
               }
           }
       });
    }
    function GetDate() {
        var dt = new Date();
        var dd;
        var mm;
        dd = dt.getDate();
        mm = dt.getMonth() + 1;
        document.getElementById('current_date').value = mm + '/' + dd + '/' + dt.getFullYear();

    }
   //function GetDate() {
   //    var dt = new Date();
   //    var dd;
   //    dd = dt.getDate();
   //    const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN",
   //                  "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"
   //    ];
   //    document.getElementById('current_date').innerHTML = dd + '-' + monthNames[dt.getMonth()] + '-' + dt.getFullYear();
   //}
   function LoadLocation() {
       $('#locationCheck').css({ "border-color": "#d3d3d3" });
       var urlpath = '@Url.Action("LoadLocation", "ExceptionRequest")';
       $.ajax({
           url: urlpath,
           dataType: 'json',
           type: "Post",
           data: {},
           async: true,
           success: function (data) {
               $('#locationCheck').empty();
               $('#locationCheck').append("<option value='0'>--Select Location --</option>");
               for (var i = 0; i < data.length; i++) {
                   $("#locationCheck").append($("<option></option>").val(data[i].LocationId)
                       .html(data[i].LocationName));
               }
           }
       });
   }
   function LoadReasonCategory() {
       $('#exceptionReasons').css({ "border-color": "#d3d3d3" });
       var urlpath = '@Url.Action("LoadReasonCategory", "ExceptionRequest")';
       $.ajax({
           url: urlpath,
           dataType: 'json',
           type: "Post",
           data: {},
           async: true,
           success: function (data) {
               $('#exceptionReasons').empty();
               $('#exceptionReasons').append("<option value='0'>--Select Reason --</option>");
               for (var i = 0; i < data.length; i++) {
                   $("#exceptionReasons").append($("<option></option>").val(data[i].ExceptioReasonsId)
                       .html(data[i].ExceptionReasonName));
               }
           }
       });
    }
   function LoadDesignation() {
        var urlpath = '@Url.Action("LoadDesignation", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
                $('#tableDesignation').empty();
                $('#tableDesignation').append("<option value='0'>Select Designation Unit</option>");
                for (var i = 0; i < data.length; i++) {
                    $("#tableDesignation").append($("<option></option>").val(data[i].DesignationId)
                        .html(data[i].DesignationName));
                }
            }
        });
    }
   function LoadSection() {
        var urlpath = '@Url.Action("LoadSection", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
                $('#tableSection').empty();
                $('#tableSection').append("<option value='0'>Select Section</option>");
                for (var i = 0; i < data.length; i++) {
                    $("#tableSection").append($("<option></option>").val(data[i].SectionId)
                        .html(data[i].SectionName));
                }
            }
        });
    }
   function LoadSubSection() {
        var urlpath = '@Url.Action("LoadSubSection", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
                $('#tableSubSection').empty();
                $('#tableSubSection').append("<option value='0'>Select Sub Section</option>");
                for (var i = 0; i < data.length; i++) {
                    $("#tableSubSection").append($("<option></option>").val(data[i].SubSectionId)
                        .html(data[i].SubSectionName));
                }
            }
        });
    }
   function LoadCategory() {
        var urlpath = '@Url.Action("LoadCategory", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
                $('#tableCategory').empty();
                $('#tableCategory').append("<option value='0'>Select Category</option>");
                for (var i = 0; i < data.length; i++) {
                    $("#tableCategory").append($("<option></option>").val(data[i].CategoryId)
                        .html(data[i].CategoryName));
                }
            }
        });
    }
  function ChangeColor(id) {
       $(id).css({ "border-color": "#d3d3d3" });
    }
     $('#showPositionCode').on('click', function () {
       debugger
           var business_unit = $('#business_unit').val();
           var month = $('#month').val();
           if ($("#business_unit").val() == "0") {
           swal({
               title: 'Please Select Business Unit ',
               type: 'error',
               closeOnCancel: true
           });


           return false;
       }
           if ($("#month").val() == "0") {
               swal({
                   title: 'Please Select Month ',
                   type: 'error',
                   closeOnCancel: true
               });


               return false;
           }
       else {
var urlpath = '@Url.Action("showExceptionRequestWisePositionCode", "ExceptionRequest")';
           $.ajax({
               url: urlpath,
               type: "Post",
               data: {
                   status: '4',
                   business_unit: business_unit,
                   month: month

               },
                   async: true,
                   success: function(data) {
                       if (data) {
                           $("#courierTypemodalbody").html("");
                           $("#courierTypemodalbody").append(data);
                           $("#courierTypeModal").modal("show");
                           $("#courierTypeshowTable").DataTable();
                       }
                   }
               });
       }

     });

    $('#addNewButton').click(function () {
        debugger;

        if ($("#courierTypeshowTable tr td input[type='checkbox']:checked").length < 1) {
            toastr.error("PLease select at least one request!");
            return;
        }
        $("#courierTypeshowTable tr td input[type='checkbox']:checked").each(function () {
            trrowNo++;
            var currentRow = $(this).closest("tr");
            var PWManpowerId = currentRow.find("td:eq(1)").text();
            var PositionCode = currentRow.find("td:eq(3)").text();
            var DepartmentId = currentRow.find("td:eq(4)").text();
            var DepartmentName = currentRow.find("td:eq(5)").text();
            var DesignationId = currentRow.find("td:eq(6)").text();
            var DesignationName = currentRow.find("td:eq(7)").text();
            var StaffCategoryId = currentRow.find("td:eq(8)").text();
            var StaffCategoryName = currentRow.find("td:eq(9)").text();
            var BudgetedHead = currentRow.find("td:eq(10)").text();
            var quantinty = '0';
            currentRow.remove();
            var appendData = `<tr id="` + PWManpowerId + `">
                                            <td>` + trrowNo + `</td>
                                            <td style="display:none;"><input type = "text"; id = "positionCode_`+ PWManpowerId + `";"; name = "positionCode"; value = ` + PositionCode + ` /></td>
                                            <td>` + PositionCode + `</td>
                                            <td style="display:none;"><input type = "number"; id = "departmentId"; name = "departmentId"; value = `+ DepartmentId + ` /></td>
                                            <td style="display:none;"><input type = "text"; id = "departmentName"; name = "departmentName"; value = `+ DepartmentName + ` /></td>
                                            <td>`+ DepartmentName + `</td>
                                            <td style="display:none;"><input type = "number"; id = "designationId"; name = "designationId"; value = `+ DesignationId + ` /></td>
                                             <td style="display:none;"><input type = "text"; id = "designationName"; name = "designationName"; value = `+ DesignationName + ` /></td>
                                            <td>`+ DesignationName + `</td>
                                            <td></td>
                                            <td style="display:none;"><input type = "number"; id = "staffCategoryId"; name = "staffCategoryId"; value = `+ StaffCategoryId + ` /></td>
                                            <td style="display:none;"><input type = "text"; id = "staffCategoryName"; name = "staffCategoryName"; value = `+ StaffCategoryName + ` /></td>
                                            <td>`+ StaffCategoryName + `</td>
                                            <td><input type = "number"; id = "unitprice"; name = "unitprice"; value = `+ BudgetedHead + ` /></td>
                                            <td><input type="number"  id="quantityy_`+ PWManpowerId + `"; value =` + quantinty + ` name="quantity" onchange="calculateGrandTotal();calculateGrandTotalunitprice()" placeholder="Enter Additoinal"  /></td>
                                            <td><input style="border:none;pointer-events:none" type = "text"; id = "additional"; name = "additional"; /></td>
                                            <td><a href="#"  id="edit_RentPayeeDist_` + PWManpowerId + `" onclick="showModal(` + PWManpowerId + `)"  class="btn btn-primary"><i class="glyphicon glyphicon-plus" style="font-size: 15px;"></i></a></td>
                                            <td><input type = "text";style="border:none;pointer-events:none"  id = "remarks"; name = "remarks"; /></td>
                                            <td><a href="javascript:restoreRequestRow(` + PWManpowerId + `);"><i class="fa fa-times-circle" style="font-size: 24px;"></i></a></td>
                                        </tr>`;
            var appendDataForModal = `<tr id="` + PWManpowerId + `Modal">
                                            <td>` + PWManpowerId + `</td
                                            <td>` + PWManpowerId + `</td>
                                            <td>` + PositionCode + `</td>
                                            <td>`+ DepartmentName + `</td>
                                            <td></td>
                                            <td>`+ DesignationName + `</td>
                                            <td>`+ StaffCategoryName + `</td>
                                            <td><input type = "number"; id = "BudgetedHead"; name = "BudgetedHead"; value = `+ BudgetedHead + ` /></td>
                                            <td><input type="number" id="quantinty" value =`+ quantinty + ` name="quantinty" onchange="calculateGrandTotal()" placeholder="Enter Additoinal"  /></td>
                                            <td><input type = "number"; id = "additional"; name = "additional"; /></td>
                                            <td></td>
                                        </tr>`;
            $('#genaralInformationBody').append(appendData);
            calculateGrandTotal();
            calculateGrandTotalunitprice();
        });

    });
    $('#addNewButtonExtend').click(function () {
        var quantityy = $("#head").val();
        var grandTotal = $("#totalammount").val();
        if (grandTotal != quantityy) {
            swal({
                title: 'you can not add ',
                type: 'error',
                closeOnCancel: true
            });

        }
        else {
            $("#detailsModal").modal("hide");
            //$("#detailsModalTableBody").empty();
            $("#genaralInformationTableExtend").show();
            debugger;
            var head = $('#head').val();
            var PositionCode = $('#positionCode').val();
            //alert(head);
            //alert(positionCode);
            if ($("#ammountInformationbody tr td ").length < 1) {
                toastr.error("PLease select at least one request!");
                return;
            }
            $("#ammountInformationbody tr").each(function () {
                var currentRow = $(this).closest("tr");
                var UnitId = $(this).find('select[name^="tableUnit"]').val();
                var UnitName = $(this).find('select[name^="tableUnit"]').children("option:selected").html();
                var SectionId = $(this).find('select[name^="tableSection"]').val();
                var SectionName = $(this).find('select[name^="tableSection"]').children("option:selected").html();
                var SubSectionId = $(this).find('select[name^="tableSubSection"]').val();
                var SubSectionName = $(this).find('select[name^="tableSubSection"]').children("option:selected").html();
                var DesignationId = $(this).find('select[name^="tableDesignation"]').val();
                var DesignationName = $(this).find('select[name^="tableDesignation"]').children("option:selected").html();
                var CategoryId = $(this).find('select[name^="tableCategory"]').val();
                var CategoryName = $(this).find('select[name^="tableCategory"]').children("option:selected").html();
                var AdditionalManpower = $(this).find('input[name^="tableHead"]').val();
                var quantinty = '0';
                // currentRow.remove();
                // $("#genaralInformationBodyExtend").reload();
                trrowNo++;
                var appendData = `<tr id="` + trrowNo + `">
                                            <td style="display:none;"><input type = "text"; id = "SectionId`+ PositionCode + `";"; name = "positionCode"; value = ` + PositionCode + ` /></td>
                                            <td>` + PositionCode + `</td>
                                            <td>` + UnitName + `</td>
                                            <td style="display:none;"><input type = "number"; id = "UnitId`+ UnitId + `";"; name = "unitId"; value = ` + UnitId + ` /></td>
                                            <td style="display:none;"><input type = "text"; id = "UnitId`+ UnitName + `";"; name = "unitName"; value = ` + UnitName + ` /></td>
                                             <td>` + SectionName + `</td>
                                            <td style="display:none;"><input type = "number"; id = "SectionId`+ SectionId + `";"; name = "sectionId"; value = ` + SectionId + ` /></td>
                                            <td style="display:none;"><input type = "text"; id = "SectionId`+ SectionName + `";"; name = "sectionName"; value = ` + SectionName + ` /></td>
                                            <td>` + SubSectionName + `</td>
                                            <td style="display:none;"><input type = "number"; id = "subSectionId"; name = "subSectionId"; value = `+ SubSectionId + ` /></td>
                                            <td style="display:none;"><input type = "text"; id = "subSectionName"; name = "subSectionName"; value = `+ SubSectionName + ` /></td>
                                            <td>`+ DesignationName + `</td>
                                            <td style="display:none;"><input type = "number"; id = "designationId"; name = "designationId"; value = `+ DesignationId + ` /></td>
                                            <td style="display:none;"><input type = "text"; id = "designationName"; name = "designationName"; value = `+ DesignationName + ` /></td>
                                            <td>`+ CategoryName + `</td>
                                            <td style="display:none;"><input type = "number"; id = "staffCategoryId"; name = "categoryId"; value = `+ CategoryId + ` /></td>
                                            <td style="display:none;"><input type = "text"; id = "categoryName"; name = "categoryName"; value = `+ CategoryName + ` /></td>
                                            <td>`+ AdditionalManpower + `</td>
                                            <td style="display:none;"><input type = "number"; id = "staffCategoryId"; name = "additionalManpower"; value = `+ AdditionalManpower + ` /></td>
                                            <td><input type="button" value="x" class="deletedbutton" onclick="restoreRequestRowd(` + trrowNo + `)" /></td>
                                            </tr>`;
                var appendDataForModal = `<tr id="` + SectionId + `Modal">
                                            <td>` + SectionId + `</td
                                            <td>` + UnitId + `</td
                                            <td>` + SectionId + `</td>
                                            <td>` + PositionCode + `</td>
                                            <td>`+ DesignationName + `</td>
                                            <td>`+ CategoryName + `</td>
                                            <td><input type = "number"; id = "BudgetedHead"; name = "BudgetedHead"; value = `+ AdditionalManpower + ` /></td>
                                            <td></td>
                                        </tr>`;
                $('#genaralInformationBodyExtend').append(appendData);
                $("#ammountInformationbody").removeData('.modal-body');
                // $("#ammountInformationbody").remove();
                calculateGrandTotal();

            });
        }


    });
    function showModal(id) {

        debugger;
       // $("#genaralInformationTableDeatils").refresh();

       // $("#quantityy_" + id).removeAttr('disabled');
        var a = $('#quantity').val();
        var quantityy = $("#quantityy_" + id).val();
        var positionCode = $("#positionCode_" + id).val();
       // alert(quantityy);
        $('#head').val(quantityy);
        $('#positionCode').val(positionCode);


      //  var PositionCode = id;
      // // var abc = $('#quantity').val();
      // // alert(abc);
      //  $("#detailsModal").modal("show");
      //  $("#detailsModal").removeData();
      // $('#detailsModalTableBody').empty();
      ////  showDataOnModal(id);
        var urlpath = '@Url.Action("showExceptionRequestWisePositione", "ExceptionRequest")';
           $.ajax({
               url: urlpath,
               type: "Post",
               data: {


               },
                   async: true,
                   success: function(data) {
                       if (data) {
                           $("#detailsModalBody").html("");
                           $("#detailsModalBody").append(data);
                           $("#detailsModal").modal("show");
                          //$("#genaralInformationTableDeatils").DataTable();
                       }
                   }
               });
    }
    var trrowNo = 0;
    function restoreRequestRow(rowval) {
        $('tr#' + rowval + '').remove();
        calculateGrandTotal();
        calculateGrandTotalunitprice();
    }
    function restoreRequestRowd(rowval) {
        $('tr#' + rowval + '').remove();
        //calculateGrandTotal();
    }
    function calculateGrandTotal() {
        var grandTotal = 0;
        var distct = 0;
        var claim = 0
        var matelia = 0;
        var garmentli = 0;
        $("#genaralInformationBody tr").each(function () {
            var qnty = $(this).find('input[name^="quantity"]').val();
            var unitprice = $(this).find('input[name^="unitprice"]').val();
            $(this).find('input[name^="additional"]').val(parseFloat(qnty) + parseFloat(unitprice));
            grandTotal += (parseFloat(qnty) + parseFloat(unitprice));
            //alert(grandTotal);
            if ($('#exception_type').val() == 2) {
                distct += ($(this).find('input[name^="discountclaim"]').val() * 1);
            } else if ($('#exception_type').val() == 3) {
                claim += ($(this).find('input[name^="claimedAmmount"]').val() * 1);
            } else if ($('#exception_type').val() == 4) {
                garmentli += ($(this).find('input[name^="garments_liability"]').val() * 1);
                matelia += ($(this).find('input[name^="materialliability"]').val() * 1);
            }
        });
        $("#totalFobs").val(grandTotal);
        $("#totaldis").val(distct);
        $("#totalclaim").val(claim);
        $("#totalmat").val(matelia);
        $("#totalgar").val(garmentli);
    }
    function calculateGrandTotalunitprice() {
        var grandTotal = 0;
        var distct = 0;
        var claim = 0
        var matelia = 0;
        var garmentli = 0;
        $("#genaralInformationBody tr").each(function () {
            var qnty = $(this).find('input[name^="quantity"]').val();
            //alert(qnty);
            grandTotal += (parseFloat(qnty));

        });
        $("#totalunitprice").val(grandTotal);

    }
    function calculateGrandTotald() {
        var grandTotal = 0;
        var distct = 0;
        var claim = 0
        var matelia = 0;
        var garmentli = 0;
        $("#ammountInformationbody tr").each(function () {
            var qnty = $(this).find('input[name^="tableHead"]').val();
            // alert(qnty);
            grandTotal += (parseFloat(qnty));

        });
        $("#totalammount").val(grandTotal);

    }
    function LoadApproverList() {
       var buid = $('#business_unit').val();
       //var buyer = $('#loadbuyer').val();
       //var scappro = $('#scapprover').val();
       $('#business_unit').css({ "border-color": "#d3d3d3" });
       //$('#loadbuyer').css({ "border-color": "#d3d3d3" });
       //$('#scapprover').css({ "border-color": "#d3d3d3" });

       var urlpath = '@Url.Action("GetApproverListMaster", "ExceptionRequest")';
       $.ajax({
           url: urlpath,
           dataType: 'json',
           type: "Post",
           data: {
               BusinessUnit: buid

           },
           async: true,
           success: function (data) {

              var result = "";
                var count = 1;
                $('#ListOfApprover tr').not(function () { return !!$(this).has('th').length; }).remove();
               // $('#subcategory').append("<option value='0'>--Select Business Unit--</option>");
                for (var i = 0; i < data.length; i++) {

                    result += "<tr data-approverid=" + data[i].UserInformationId + ">"
                    //result += "<td>" + count + "<td>"Designation
                    if (data.length > 2) {
                        result += "<td style='text-align: center;width:25px'><input type='checkbox' checked class='approval' id='enableCheck' value=" + data[i].UserInformationId + " data-username=\"" + data[i].UserInformationName + "\" data-designation=\"" + data[i].DesignationName + "\"></td>"
                    }
                    else {
                        result += "<td style='text-align: center;width:25px'><input type='checkbox' checked disabled class='approval' id='enableCheck' value=" + data[i].UserInformationId + " data-username=\"" + data[i].UserInformationName + "\" data-designation=\"" + data[i].DesignationName + "\"></td>"
                    }

                    result += '<td><p name="approverNo">' + count + '</p></td>';
                    result += '<td><p name="userName">' + data[i].UserInformationName + '</p></td>';
                    result += '<td><p name="designation">' + data[i].DesignationName + '</p></td>';
                    result += "</tr>"
                    count++;
                }

                $('#ListOfApprover').append(result);
           }
       });
    }
    function deleterow(rowvala) {
        $('tr#' + rowvala + '').remove();
    }
    var trrowNo = 0;
    function deletedrow(rowval) {
        $('tr#' + rowval + '').remove();
         calculateGrandTotald();
    }
    function addnewAmmount() {
        $('#genaralInformationTableDeatils').show();
        //if ($('#styleName').val() == "") {
        //    ShowAlert();
        //} else if ($('#colorName').val() == "") {
        //    ShowAlert();
        //} else if ($('#PoName').val() == "") {
        //    ShowAlert();
        //} else {
        trrowNo++;
        var col = '<tr id="' + trrowNo + '">'
        col += '<td ><select type="text" style="width:100px;" id="tableUnit' + trrowNo + '" data-number="' + trrowNo + '" name="tableUnit" placeholder="Enter Designation"   /></td>';
        col += '<td ><select type="text" style="width:100px;" id="tableSection' + trrowNo + '" data-number="' + trrowNo + '" name="tableSection" placeholder="Enter Designation"   /></td>';
        /* col += '<td ><input type="text"  name="tableUserID" placeholder="Enter User ID"  /></td>';*/
        col += '<td ><select type="text" style="width:100px;" id="tableSubSection' + trrowNo + '" data-number="' + trrowNo + '" name="tableSubSection" placeholder="Enter Designation"   /></td>';
        col += '<td ><select type="text" style="width:100px;" id="tableDesignation' + trrowNo + '" data-number="' + trrowNo + '" name="tableDesignation" placeholder="Enter Designation"   /></td>';
        col += '<td ><select type="text" style="width:100px;" id="tableCategory' + trrowNo + '" data-number="' + trrowNo + '" name="tableCategory" placeholder="Enter Designation" onchange="calculatedGrandTotalValue()"  /></td>';
        col += '<td ><input type="text" name="tableHead" placeholder="Enter Head" onchange="calculateGrandTotald()"  /></td>';
        col += '<td><input type="button" value="x" class="deletedbutton" onclick="deletedrow(' + trrowNo + ')" /></td></tr>';
        $("#ammountInformationbody").append(col);
        /* calculatedGrandTotalValue();*/
        calculateGrandTotald();
        //}
        LoadUnita("#tableUnit" + trrowNo);
        LoadSectiona("#tableSection" + trrowNo);
        LoadSubSectiona("#tableSubSection" + trrowNo);
        LoadDesignationa("#tableDesignation" + trrowNo);
        LoadCategorya("#tableCategory" + trrowNo);
        // LoadDepartmenta("#tableDepartment" + trrowNo)
        // alert("#tableDesignation" + trrowNo);
    }
    function LoadUnita(ID) {
        debugger;
        var urlpath = '@Url.Action("LoadUnit", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
               // console.log(data);
                if (data.length > 0) {
                    $(ID).html('');

                    var result = '';
                    result += "<option value=''>Select Unit</option>";
                    for (var i = 0; data.length > i; i++) {
                        result += "<option id='" + data[i].UnitId + "' value='" + data[i].UnitId + "' data-shortname='" + data[i].UnitId + "'>" + data[i].UnitName + "</option>";
                    }
                    $(ID).append(result);
                    $('select.country').append(result);
                }

            }
        });
    }
     function LoadSectiona(ID) {
        debugger;
        var urlpath = '@Url.Action("LoadSection", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
               // console.log(data);
                if (data.length > 0) {
                    $(ID).html('');

                    var result = '';
                    result += "<option value=''>Select Section</option>";
                    for (var i = 0; data.length > i; i++) {
                        result += "<option id='" + data[i].SectionId + "' value='" + data[i].SectionId + "' data-shortname='" + data[i].SectionId + "'>" + data[i].SectionName + "</option>";
                    }
                    $(ID).append(result);
                    $('select.country').append(result);
                }

            }
        });
    }
        function LoadSubSectiona(ID) {
        debugger;
        var urlpath = '@Url.Action("LoadSubSection", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
               // console.log(data);
                if (data.length > 0) {
                    $(ID).html('');

                    var result = '';
                    result += "<option value=''>Select Sub Section</option>";
                    for (var i = 0; data.length > i; i++) {
                        result += "<option id='" + data[i].SubSectionId + "' value='" + data[i].SubSectionId + "' data-shortname='" + data[i].SubSectionId + "'>" + data[i].SubSectionName + "</option>";
                    }
                    $(ID).append(result);
                    $('select.country').append(result);
                }

            }
        });
    }
    function LoadCategorya(ID) {
        debugger;
        var urlpath = '@Url.Action("LoadCategory", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
               // console.log(data);
                if (data.length > 0) {
                    $(ID).html('');

                    var result = '';
                    result += "<option value=''>Select Category</option>";
                    for (var i = 0; data.length > i; i++) {
                        result += "<option id='" + data[i].CategoryId + "' value='" + data[i].CategoryId + "' data-shortname='" + data[i].CategoryId + "'>" + data[i].CategoryName + "</option>";
                    }
                    $(ID).append(result);
                    $('select.country').append(result);
                }

            }
        });
    }
       function LoadDesignationa(ID) {
        debugger;
        var urlpath = '@Url.Action("LoadDesignation", "ExceptionRequest")';
        $.ajax({
            url: urlpath,
            dataType: 'json',
            type: "Post",
            data: {},
            async: true,
            success: function (data) {
               // console.log(data);
                if (data.length > 0) {
                    $(ID).html('');

                    var result = '';
                    result += "<option value=''>Select Designation</option>";
                    for (var i = 0; data.length > i; i++) {
                        result += "<option id='" + data[i].DesignationId + "' value='" + data[i].DesignationId + "' data-shortname='" + data[i].DesignationId + "'>" + data[i].DesignationName + "</option>";
                    }
                    $(ID).append(result);
                    $('select.country').append(result);
                }

            }
        });
    }
    function formValidate() {
        debugger;
        if ($("#exception_type").val() == "0") {
            $('#exception_type').css({ "border-color": "#FF0000" });
        } else if ($("#exceptionReasons").val() == "0") {
            $('#exceptionReasons').css({ "border-color": "#FF0000" });
        } else if ($("#locationCheck").val() == "0") {
            $('#locationCheck').css({ "border-color": "#FF0000" });
        } else if ($("#business_unit").val() == "0") {
            $('#business_unit').css({ "border-color": "#FF0000" });
        } else if ($("#month").val() == "0") {
            $('#month').css({ "border-color": "#FF0000" });
        }

        else {

            varifyInputElement();
        }
    }

     function varifyInputElement() {
        var jsondate = GetInputData();
        var urlpath = '@Url.Action("ModalShowBeforeSubmit", "ExceptionRequest")';
            $.ajax({
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(jsondate),
                url: urlpath,
                type: "POST",
                async: true,
                success: function (data) {
                    $("#modalbody").html("");
                    $("#modalbody").append(data);
                    $("#myModal").modal("show");
                },
                error: function () {
                    alert("Error");
                }
            });
    }
    function GetInputData() {
        debugger;
        var jsonData = {};
        jsonData["CreateDate"] = new Date();
        jsonData["ExceptionTypeName"] = $("#exception_type").children("option:selected").html();
        jsonData["ExpTypeId"] = $("#exception_type").val();
        jsonData["ExpReasonId"] = $("#exceptionReasons").val();
        jsonData["ExceptionReasonName"] = $("#exceptionReasons").children("option:selected").html();
        jsonData["BusinessUnitId"] = $("#business_unit").val();
        jsonData["BusinessUnitName"] = $("#business_unit").children("option:selected").html();
        jsonData["LocationId"] = '2';
        jsonData["LocationName"] ='Manufacturing Facility';
        jsonData["Month"] = $("#month").children("option:selected").html();
        jsonData["Comment"] = $("#comments ").val();
        var ExceptionDetailsList = [];
        $('#genaralInformationBody tr').each(function () {
            var myData = {};
            myData["PositionCode"] = $(this).find('input[name^="positionCode"]').val();
            myData["Department"] = $(this).find('input[name^="departmentId"]').val();
            myData["DepartmentName"] = $(this).find('input[name^="departmentName"]').val();
            myData["Designation"] = $(this).find('input[name^="designationId"]').val();
            myData["DesignationName"] = $(this).find('input[name^="designationName"]').val();
            myData["StaffCategory"] = $(this).find('input[name^="staffCategoryId"]').val();
            myData["StaffCategoryName"] = $(this).find('input[name^="staffCategoryName"]').val();
            myData["Current_Bdg_Man"] = $(this).find('input[name^="unitprice"]').val();
            myData["No_Of_Add_Req"] = $(this).find('input[name^="quantity"]').val();
            myData["To_Bdg_Man"] = $(this).find('input[name^="additional"]').val();
            myData["Remarks"] = $(this).find('input[name^="remarks"]').val();
            ExceptionDetailsList.push(myData);
        });
        jsonData["ExceptionDetailsList"] = ExceptionDetailsList;
        var ExceptionDetailsExtendList = [];
        $('#genaralInformationBodyExtend tr').each(function () {
            var myData = {};
            myData["PositionCode"] = $(this).find('input[name^="positionCode"]').val();
            myData["UnitId"] = $(this).find('input[name^="unitId"]').val();
            myData["UnitName"] = $(this).find('input[name^="unitName"]').val();
            myData["SectionId"] = $(this).find('input[name^="sectionId"]').val();
            myData["SectionName"] = $(this).find('input[name^="sectionName"]').val();
            myData["SubSectionId"] = $(this).find('input[name^="subSectionId"]').val();
            myData["SubSectionName"] = $(this).find('input[name^="subSectionName"]').val();
            myData["DesignationId"] = $(this).find('input[name^="designationId"]').val();
            myData["DesignationName"] = $(this).find('input[name^="designationName"]').val();
            myData["CategoryId"] = $(this).find('input[name^="categoryId"]').val();
            myData["CategoryName"] = $(this).find('input[name^="categoryName"]').val();
            myData["AdditionalManpower"] = $(this).find('input[name^="additionalManpower"]').val();
            ExceptionDetailsExtendList.push(myData);
        });
        jsonData["ExceptionDetailsExtendList"] = ExceptionDetailsExtendList;
        var approverList = [];
        var count = 1;
        $("#ListOfApprover tr td input[type='checkbox']:checked").each(function () {


            var approver = {};

            approver["ApproverId"] = $(this).val();
            approver["UserID"] = $(this).val();
            approver["ApproverNo"] = count //$(this).find('p[name^="approverNo"]').html();
            approver["UserName"] = $(this).attr('data-username');//$(this).find('p[name^="userName"]').html();
            approver["DesignationName"] = $(this).attr('data-designation'); //$(this).find('p[name^="designation"]').html();


            if (approver["ApproverNo"] == 1) {
                approver["ApproverStatus"] = 1;
                approver["ApproverStatusName"] = "First Approver"
            } else if (approver["ApproverNo"] == 2) {
                approver["ApproverStatus"] = 2;
                approver["ApproverStatusName"] = "Second Approver"
            } else {
                approver["ApproverStatus"] = 3;
                approver["ApproverStatusName"] = "Third Approver"
            }



            approverList.push(approver);
            count++;
        })

        jsonData["ApproverList"] = approverList;
        return jsonData;
    }
     function SubmitToDatabase() {
        var jsondate = GetInputData();
        var urlpath = '@Url.Action("SaveExceptionRequest", "ExceptionRequest")';
           $.ajax({
               contentType: "application/json; charset=utf-8",
               data: JSON.stringify(jsondate),
               url: urlpath,
               type: "POST",
               async: true,
               success: function (data) {
                   swal({
                       title: 'Exception Request Submit Successfully',
                       type: 'success',
                       closeOnCancel: true
                   },function () {
                           $("#myModal").modal("hide");
                            $("#exceptionSubmrnu").find('li').removeClass();
                           $("#exceptionSubmrnu").find('li:nth-child(2)').addClass("active");
                                   GetAllExceptionRequest(1,0);
                               });
                  // ExceptionFileUpload(data.pk);
               },
               error: function () {
                   alert("Error");
               }
           });
   }

</script>

